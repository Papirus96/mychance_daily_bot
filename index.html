
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üéÅ –í—Å–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω–∫—É—Ä—Å—ã (VIP) ‚Äî –®–ê–ù–°</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg:#ffcc66;
      --panel:#fff8e1;
      --accent:#a64214;
      --border:#e0a958;
      --thead:#ffd27f;
      --track:#ffdca8;
      --thumb:#a64214;
    }
    *{box-sizing:border-box}
    body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#7a2e14;margin:0;padding:14px}
    h1{margin:0 0 12px;text-align:center;color:var(--accent);line-height:1.2}
    .wrap{
      position:relative;
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:6px;
      padding:10px 10px 16px;
      max-height:82vh;
      overflow:auto; /* –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */
    }
    .table-scroll{
      overflow:auto;       /* –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ (—Å–∫—Ä—ã–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å–∫—Ä–æ–ª–ª) */
      border:1px solid var(--border);
      scrollbar-width:none; /* firefox */
    }
    .table-scroll::-webkit-scrollbar{display:none} /* webkit */
    table{
      border-collapse:collapse;
      width:100%;
      min-width:1200px;     /* —è–≤–Ω—ã–π –Ω–∞–º—ë–∫ –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö */
      background:var(--panel);
    }
    th,td{
      border:1px solid var(--border);
      padding:10px;
      text-align:left;
      vertical-align:top;
    }
    th{
      background:var(--thead);
      position:sticky;
      top:0;
      z-index:5;
    }
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}

    /* —Å—Ç—Ä–µ–ª–∫–∞‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–∞ –≤–ø—Ä–∞–≤–æ */
    .hint-right{
      position:absolute;
      right:14px;
      top:46px;
      width:32px;height:32px;
      border-radius:50%;
      background:rgba(166,66,20,.9);
      display:none;
      align-items:center;justify-content:center;
      color:#fff; font-size:20px; line-height:1;
      box-shadow:0 2px 10px rgba(0,0,0,.25);
      animation:pulse 1.6s ease-in-out infinite;
      z-index:10;
    }
    @keyframes pulse{0%,100%{transform:translateX(0)}50%{transform:translateX(5px)}}

    /* –í–ù–ï–®–ù–ò–ô –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –ø–æ–ª–∑—É–Ω–æ–∫ */
    .hscroll{
  margin-top:8px;
  height:14px;
  background:var(--track);
  border:1px solid var(--border);
  border-radius:10px;
  position:sticky;     /* ‚Üê —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤–Ω—É—Ç—Ä–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ —Å–∫—Ä–æ–ª–ª—è—â–µ–π—Å—è .wrap */
  bottom:0;            /* ‚Üê —É –Ω–∏–∂–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã .wrap */
  left:0;
  right:0;
  user-select:none;
  touch-action:none;
}
    .hscroll .thumb{
      position:absolute;
      top:1px;
      left:1px;
      height:10px;
      background:var(--thumb);
      border-radius:8px;
      box-shadow:0 1px 3px rgba(0,0,0,.25);
      cursor:grab;
    }
    .hscroll .thumb:active{cursor:grabbing}
	/* –≤–Ω–µ—à–Ω–∏–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
.vscroll{
  width:14px;
  background:var(--track);
  border:1px solid var(--border);
  border-radius:10px;
  position:absolute;
  top:0;             /* —Å–≤–µ—Ä—Ö—É –≤–º–µ—Å—Ç–µ —Å wrap */
  bottom:30px;       /* –æ—Å—Ç–∞–≤–ª—è–µ–º –º–µ—Å—Ç–æ –ø–æ–¥ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π */
  right:0;
  user-select:none;
  touch-action:none;
  display:none;
}
.vscroll .thumb{
  position:absolute;
  left:1px;
  width:10px;
  background:var(--thumb);
  border-radius:8px;
  box-shadow:0 1px 3px rgba(0,0,0,.25);
  cursor:grab;
}
.vscroll .thumb:active{cursor:grabbing}
  </style>
</head>
<body>
  <h1>üéÅ –í—Å–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω–∫—É—Ä—Å—ã (VIP)</h1>

  <div class="wrap" id="wrap">
    <div class="hint-right" id="hintRight">‚ûú</div>

    <div class="table-scroll" id="ts">
      <table id="tbl">
        <thead>
          <tr>
            <th>–ö–∞–Ω–∞–ª</th>
            <th>–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–æ–∑—ã–≥—Ä—ã—à</th>
            <th>–ü—Ä–∏–∑—ã</th>
            <th>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</th>
            <th>–£—Å–ª–æ–≤–∏—è</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- –í–ù–ï–®–ù–ò–ô –ø–æ–ª–∑—É–Ω–æ–∫ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ -->
    <div class="hscroll" id="hscroll"><div class="thumb" id="hthumb" style="width:40px"></div></div>
	<!-- –í–ù–ï–®–ù–ò–ô –ø–æ–ª–∑—É–Ω–æ–∫ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ -->
<div class="vscroll" id="vscroll"><div class="thumb" id="vthumb" style="height:40px"></div></div>
  </div>

  <script>
    // –ú–∞–∫—Å–∏–º–∏–∑–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É –æ–∫–Ω–∞ –º–∏–Ω–∏‚Äë–∞–ø–ø–∞
    try{Telegram.WebApp.ready(); Telegram.WebApp.expand();}catch(e){}

    const SHEET_ID   = "1ywWbGtsvKfrYdxFsekvXL7EKmd30_xxZQB0E8XqUU8U";
    const SHEET_NAME = "–ö–æ–Ω–∫—É—Ä—Å—ã –®–ê–ù–°";
    const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}&range=A:G`;

    function normalizeTelegramLink(raw){
      if(!raw) return null;
      let s = String(raw).trim();
      if(!s) return null;
      if(s.startsWith("@")) s = "https://t.me/" + s.slice(1);
      if(s.startsWith("t.me/")||s.startsWith("telegram.me/")) s = "https://" + s;
      if(!/^https?:\/\//i.test(s) && /^[A-Za-z0-9_\/]+$/.test(s)) s = "https://t.me/" + s;
      return /^https?:\/\//i.test(s) ? s : null;
    }
    function parseSheetDate(val){
      if(!val) return null;
      const str = String(val);
      let m = str.match(/Date\((\d+),\s*(\d+),\s*(\d+)\)/);
      if(m) return new Date(+m[1],+m[2],+m[3]);
      m = str.match(/^(\d{1,2})[.\-\/](\d{1,2})[.\-\/](\d{2,4})$/);
      if(m) return new Date((m[3].length===2?('20'+m[3]):m[3]), +m[2]-1, +m[1]);
      const d = new Date(str); return isNaN(d)?null:d;
    }
    function formatDate(val){
      const d = parseSheetDate(val); if(!d) return val||"";
      return d.toLocaleDateString("ru-RU",{day:"2-digit",month:"long",year:"numeric"});
    }
    function onlyActive(endRaw, filterRaw){
      const today = new Date(); today.setHours(0,0,0,0);
      const df = parseSheetDate(filterRaw)||parseSheetDate(endRaw);
      if(!df) return true; return df>=today;
    }
    function linkify(text){
      if(!text) return "";
      let t = String(text).replace(/\r\n|\r/g,"\n");
      t = t.replace(/((https?:\/\/)[^\s<]+)/gi, m=>`<a href="${m}" target="_blank">${m}</a>`);
      t = t.replace(/(?:^|\s)(?:https?:\/\/)?(?:t\.me|telegram\.me)\/([A-Za-z0-9_\/]+)/gi,(m,p1)=>` <a href="https://t.me/${p1}" target="_blank">https://t.me/${p1}</a>`);
      t = t.replace(/(^|\s)@([A-Za-z0-9_]+)/g,(m,sp,u)=>`${sp}<a href="https://t.me/${u}" target="_blank">@${u}</a>`);
      return t.replace(/\n/g,"<br>");
    }

    fetch(URL)
      .then(r=>r.text())
      .then(txt=>{
        const json = JSON.parse(txt.substr(47).slice(0,-2));
        const rows = json.table.rows || [];
        const tbody = document.querySelector("#tbl tbody");

        rows.forEach(row=>{
          const cells = (row.c||[]).map(c => (c && (c.v!==undefined ? c.v : c.f)) || "");
          if(!onlyActive(cells[3], cells[5])) return;

          const tr = document.createElement("tr");

          // A –ö–∞–Ω–∞–ª
          const chTd = document.createElement("td");
          const chUrl = normalizeTelegramLink(cells[0]);
          if(chUrl){
            const a=document.createElement("a"); a.href=chUrl; a.target="_blank";
            a.textContent = chUrl.replace(/^https?:\/\/(t\.me|telegram\.me)\//i,"");
            chTd.appendChild(a);
          } else chTd.textContent = cells[0]||"-";
          tr.appendChild(chTd);

          // B –ü–æ—Å—Ç
          const postTd = document.createElement("td");
          const postUrl = normalizeTelegramLink(cells[1]) || (cells[1] && /^https?:\/\//i.test(cells[1]) ? cells[1] : null);
          if(postUrl){
            const a=document.createElement("a"); a.href=postUrl; a.target="_blank"; a.textContent="–û—Ç–∫—Ä—ã—Ç—å";
            postTd.appendChild(a);
          } else postTd.textContent = cells[1]||"-";
          tr.appendChild(postTd);

          // C –ü—Ä–∏–∑—ã
          const prizesTd=document.createElement("td");
          prizesTd.innerHTML = linkify(cells[2]||"");
          tr.appendChild(prizesTd);

          // D –î–∞—Ç–∞
          const dTd=document.createElement("td");
          dTd.textContent = formatDate(cells[3]);
          tr.appendChild(dTd);

          // E –£—Å–ª–æ–≤–∏—è
          const condTd=document.createElement("td");
          condTd.innerHTML = linkify(cells[4]||"");
          tr.appendChild(condTd);

          tbody.appendChild(tr);
        });

        if(!tbody.children.length){
          const tr=document.createElement("tr");
          const td=document.createElement("td"); td.colSpan=5; td.textContent="–ù–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä—Å–æ–≤.";
          tr.appendChild(td); tbody.appendChild(tr);
        }

        // --- –í–ù–ï–®–ù–ò–ô –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–´–ô –°–ö–†–û–õ–õ ---
        const ts = document.getElementById("ts");
        const track = document.getElementById("hscroll");
        const thumb = document.getElementById("hthumb");
        const hint  = document.getElementById("hintRight");

        function syncThumb(){
          const sw = ts.scrollWidth, cw = ts.clientWidth;
          const tw = track.clientWidth;
          // —à–∏—Ä–∏–Ω–∞ –ø–æ–ª–∑—É–Ω–∫–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏
          const thumbW = Math.max(32, Math.round(tw * (cw / sw)));
          thumb.style.width = thumbW + "px";
          // –ø–æ–∑–∏—Ü–∏—è –ø–æ–ª–∑—É–Ω–∫–∞
          const maxLeft = tw - thumbW - 2;
          const left = Math.round((ts.scrollLeft / (sw - cw)) * maxLeft);
          thumb.style.left = (isFinite(left)? left : 0) + "px";

          // –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç—Ä–µ–ª–∫—É, –µ—Å–ª–∏ –µ—Å—Ç—å —á—Ç–æ —Å–∫—Ä–æ–ª–ª–∏—Ç—å –≤–ø—Ä–∞–≤–æ
          const needHint = sw > cw && ts.scrollLeft < (sw - cw - 8);
          hint.style.display = needHint ? "flex" : "none";
          // –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π —Å–∫—Ä–æ–ª–ª –µ—Å–ª–∏ –µ—Å—Ç—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ
          track.style.display = (sw > cw) ? "block" : "none";
        }

        function scrollFromThumb(clientX){
          const rect = track.getBoundingClientRect();
          const tw = track.clientWidth;
          const thW = thumb.clientWidth;
          const maxLeft = tw - thW - 2;
          let left = Math.min(Math.max(0, clientX - rect.left - thW/2), maxLeft);
          thumb.style.left = left + "px";

          // –ø–µ—Ä–µ–≤–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é –ø–æ–ª–∑—É–Ω–∫–∞ –≤ scrollLeft —Ç–∞–±–ª–∏—Ü—ã
          const sw = ts.scrollWidth, cw = ts.clientWidth;
          const ratio = left / maxLeft;
          ts.scrollLeft = (sw - cw) * ratio;
        }

        // Drag & click –ø–æ —Ç—Ä–µ–∫—É
        let dragging = false;
        thumb.addEventListener("mousedown", e=>{ dragging=true; e.preventDefault(); });
        document.addEventListener("mousemove", e=>{ if(dragging){ scrollFromThumb(e.clientX); } });
        document.addEventListener("mouseup",   ()=>{ dragging=false; });

        // –¢–∞—á‚Äë–ø–æ–¥–¥–µ—Ä–∂–∫–∞
        thumb.addEventListener("touchstart", e=>{ dragging=true; }, {passive:true});
        document.addEventListener("touchmove", e=>{ if(dragging){ scrollFromThumb(e.touches[0].clientX); } }, {passive:true});
        document.addEventListener("touchend",  ()=>{ dragging=false; }, {passive:true});

        // –ö–ª–∏–∫ –ø–æ —Ç—Ä–µ–∫—É
        track.addEventListener("mousedown", e=>{ if(e.target!==thumb){ scrollFromThumb(e.clientX); } });

        // –°–≤—è–∑—å —Å –Ω–∞—Ç–∏–≤–Ω—ã–º —Å–∫—Ä–æ–ª–ª–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
        ts.addEventListener("scroll", syncThumb);
        window.addEventListener("resize", syncThumb);
        setTimeout(syncThumb, 0);
      })
      .catch(err=>{
        console.error(err);
        const tbody = document.querySelector("#tbl tbody");
        const tr=document.createElement("tr");
        const td=document.createElement("td"); td.colSpan=5; td.textContent="–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
        tr.appendChild(td); tbody.appendChild(tr);
      });
// --- –í–ù–ï–®–ù–ò–ô –í–ï–†–¢–ò–ö–ê–õ–¨–ù–´–ô –°–ö–†–û–õ–õ (–¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ #wrap) ---
const vTrack = document.getElementById('vscroll'); // —Ç—Ä–µ–∫ —Å–ø—Ä–∞–≤–∞
const vThumb = document.getElementById('vthumb');  // –±–µ–≥—É–Ω–æ–∫
const sc     = document.getElementById('wrap');    // –í–ï–†–¢–ò–ö–ê–õ–¨–ù–û –°–ö–†–û–õ–õ–ò–¢–°–Ø –ò–ú–ï–ù–ù–û .wrap

function syncV(){
  const sh = sc.scrollHeight;
  const ch = sc.clientHeight;

  // –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Ç—Ä–µ–∫ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è
  vTrack.style.display = (sh > ch) ? 'block' : 'none';
  if (sh <= ch) return;

  const trackH = vTrack.clientHeight;
  const thumbH = Math.max(32, Math.round(trackH * (ch / sh)));
  vThumb.style.height = thumbH + 'px';

  const maxTop = trackH - thumbH - 2;
  const top = Math.round((sc.scrollTop / (sh - ch)) * maxTop);
  vThumb.style.top = (isFinite(top) ? top : 0) + 'px';
}

function setScrollFromThumb(clientY){
  const rect   = vTrack.getBoundingClientRect();
  const trackH = vTrack.clientHeight;
  const thumbH = vThumb.clientHeight;
  const maxTop = trackH - thumbH - 2;

  let top = Math.min(Math.max(0, clientY - rect.top - thumbH/2), maxTop);
  vThumb.style.top = top + 'px';

  const sh = sc.scrollHeight;
  const ch = sc.clientHeight;
  sc.scrollTop = (sh - ch) * (top / maxTop);
}

let vDrag = false;
vThumb.addEventListener('mousedown', e => { vDrag = true; e.preventDefault(); });
document.addEventListener('mousemove', e => { if (vDrag) setScrollFromThumb(e.clientY); });
document.addEventListener('mouseup',   () => { vDrag = false; });

vThumb.addEventListener('touchstart', () => { vDrag = true; }, {passive:true});
document.addEventListener('touchmove', e => { if (vDrag) setScrollFromThumb(e.touches[0].clientY); }, {passive:true});
document.addEventListener('touchend',  () => { vDrag = false; }, {passive:true});

// –∫–ª–∏–∫ –ø–æ —Ç—Ä–µ–∫—É
vTrack.addEventListener('mousedown', e => { if (e.target !== vThumb) setScrollFromThumb(e.clientY); });

// —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ –≤—Å–µ–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏
sc.addEventListener('scroll', () => { syncThumb(); syncV(); });
window.addEventListener('resize', () => { syncThumb(); syncV(); });
setTimeout(() => { syncThumb(); syncV(); }, 0);
  </script>
</body>
</html>
