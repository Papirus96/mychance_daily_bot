
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üéÅ –í—Å–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω–∫—É—Ä—Å—ã (VIP) ‚Äî –®–ê–ù–°</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg:#ffcc66;
      --panel:#fff8e1;
      --accent:#a64214;
      --border:#e0a958;
      --thead:#ffd27f;
    }
    *{box-sizing:border-box}
    body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#7a2e14;margin:0;padding:14px}
    h1{margin:0 0 12px;text-align:center;color:var(--accent);line-height:1.2}
    .wrap{
      position:relative;
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:6px;
      padding:10px;
      /* –≤—ã—Å–æ—Ç–∞ –ø–æ–¥ –æ–∫–Ω–æ –º–∏–Ω–∏‚Äë–∞–ø–ø–∞ */
      max-height:82vh;
      overflow:auto; /* –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞, –µ—Å–ª–∏ —Å—Ç—Ä–æ–∫ –º–Ω–æ–≥–æ */
    }
    .table-scroll{
      overflow:auto;       /* –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */
      border:1px solid var(--border);
    }
    table{
      border-collapse:collapse;
      width:100%;
      min-width:1100px;     /* —á—Ç–æ–±—ã –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ –±—ã–ª –≤–∏–¥–µ–Ω –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
      background:var(--panel);
    }
    th,td{
      border:1px solid var(--border);
      padding:10px;
      text-align:left;
      vertical-align:top;
    }
    th{
      background:var(--thead);
      position:sticky;
      top:0;                /* –ø—Ä–∏–ª–∏–ø—à–∞—è —à–∞–ø–∫–∞ */
      z-index:5;
    }
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    /* —Å—Ç—Ä–µ–ª–∫–∞‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≤–ø—Ä–∞–≤–æ */
    .hint-right{
      position:absolute;
      right:12px;
      top:46px;
      width:28px;height:28px;
      border-radius:50%;
      background:rgba(166,66,20,.85);
      display:none;
      align-items:center;justify-content:center;
      color:#fff; font-size:18px; line-height:1;
      box-shadow:0 2px 8px rgba(0,0,0,.2);
      animation:pulse 1.6s ease-in-out infinite;
      z-index:10;
    }
    @keyframes pulse{0%,100%{transform:translateX(0)}50%{transform:translateX(4px)}}
    /* –ø–ª–∞–≤–Ω—ã–µ —Å–∫—Ä–æ–ª–ª‚Äë–ø–æ–ª–æ—Å—ã */
    .wrap::-webkit-scrollbar,
    .table-scroll::-webkit-scrollbar{height:10px;width:10px}
    .wrap::-webkit-scrollbar-thumb,
    .table-scroll::-webkit-scrollbar-thumb{background:var(--border);border-radius:8px}
    .wrap::-webkit-scrollbar-track,
    .table-scroll::-webkit-scrollbar-track{background:#ffe7b1}
  </style>
</head>
<body>
  <h1>üéÅ –í—Å–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω–∫—É—Ä—Å—ã (VIP)</h1>

  <div class="wrap" id="wrap">
    <div class="hint-right" id="hintRight">‚ûú</div>
    <div class="table-scroll" id="ts">
      <table id="tbl">
        <thead>
          <tr>
            <th>–ö–∞–Ω–∞–ª</th>
            <th>–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–æ–∑—ã–≥—Ä—ã—à</th>
            <th>–ü—Ä–∏–∑—ã</th>
            <th>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</th>
            <th>–£—Å–ª–æ–≤–∏—è</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    // –ú–∞–∫—Å–∏–º–∏–∑–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É –æ–∫–Ω–∞ –º–∏–Ω–∏‚Äë–∞–ø–ø–∞
    try{Telegram.WebApp.ready(); Telegram.WebApp.expand();}catch(e){}

    const SHEET_ID   = "1ywWbGtsvKfrYdxFsekvXL7EKmd30_xxZQB0E8XqUU8U";
    const SHEET_NAME = "–ö–æ–Ω–∫—É—Ä—Å—ã –®–ê–ù–°";
    const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}&range=A:G`;

    function normalizeTelegramLink(raw){
      if(!raw) return null;
      let s = String(raw).trim();
      if(!s) return null;
      if(s.startsWith("@")) s = "https://t.me/" + s.slice(1);
      if(s.startsWith("t.me/")||s.startsWith("telegram.me/")) s = "https://" + s;
      if(!/^https?:\/\//i.test(s) && /^[A-Za-z0-9_\/]+$/.test(s)) s = "https://t.me/" + s;
      return /^https?:\/\//i.test(s) ? s : null;
    }
    function parseSheetDate(val){
      if(!val) return null;
      const str = String(val);
      let m = str.match(/Date\((\d+),\s*(\d+),\s*(\d+)\)/);
      if(m) return new Date(+m[1],+m[2],+m[3]);
      m = str.match(/^(\d{1,2})[.\-\/](\d{1,2})[.\-\/](\d{2,4})$/);
      if(m) return new Date((m[3].length===2?('20'+m[3]):m[3]), +m[2]-1, +m[1]);
      const d = new Date(str); return isNaN(d)?null:d;
    }
    function formatDate(val){
      const d = parseSheetDate(val); if(!d) return val||"";
      return d.toLocaleDateString("ru-RU",{day:"2-digit",month:"long",year:"numeric"});
    }
    function onlyActive(endRaw, filterRaw){
      const today = new Date(); today.setHours(0,0,0,0);
      const df = parseSheetDate(filterRaw)||parseSheetDate(endRaw);
      if(!df) return true; return df>=today;
    }
    function linkify(text){
      if(!text) return "";
      let t = String(text).replace(/\r\n|\r/g,"\n");
      t = t.replace(/((https?:\/\/)[^\s<]+)/gi, m=>`<a href="${m}" target="_blank">${m}</a>`);
      t = t.replace(/(?:^|\s)(?:https?:\/\/)?(?:t\.me|telegram\.me)\/([A-Za-z0-9_\/]+)/gi,(m,p1)=>` <a href="https://t.me/${p1}" target="_blank">https://t.me/${p1}</a>`);
      t = t.replace(/(^|\s)@([A-Za-z0-9_]+)/g,(m,sp,u)=>`${sp}<a href="https://t.me/${u}" target="_blank">@${u}</a>`);
      return t.replace(/\n/g,"<br>");
    }

    fetch(URL)
      .then(r=>r.text())
      .then(txt=>{
        const json = JSON.parse(txt.substr(47).slice(0,-2));
        const rows = json.table.rows || [];
        const tbody = document.querySelector("#tbl tbody");

        rows.forEach(row=>{
          const cells = (row.c||[]).map(c => (c && (c.v!==undefined ? c.v : c.f)) || "");
          if(!onlyActive(cells[3], cells[5])) return; // —Ñ–∏–ª—å—Ç—Ä –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏

          const tr = document.createElement("tr");

          // A –ö–∞–Ω–∞–ª
          const chTd = document.createElement("td");
          const chUrl = normalizeTelegramLink(cells[0]);
          if(chUrl){
            const a=document.createElement("a"); a.href=chUrl; a.target="_blank";
            a.textContent = chUrl.replace(/^https?:\/\/(t\.me|telegram\.me)\//i,"");
            chTd.appendChild(a);
          } else chTd.textContent = cells[0]||"-";
          tr.appendChild(chTd);

          // B –ü–æ—Å—Ç
          const postTd = document.createElement("td");
          const postUrl = normalizeTelegramLink(cells[1]) || (cells[1] && /^https?:\/\//i.test(cells[1]) ? cells[1] : null);
          if(postUrl){
            const a=document.createElement("a"); a.href=postUrl; a.target="_blank"; a.textContent="–û—Ç–∫—Ä—ã—Ç—å";
            postTd.appendChild(a);
          } else postTd.textContent = cells[1]||"-";
          tr.appendChild(postTd);

          // C –ü—Ä–∏–∑—ã
          const prizesTd=document.createElement("td");
          prizesTd.innerHTML = linkify(cells[2]||"");
          tr.appendChild(prizesTd);

          // D –î–∞—Ç–∞
          const dTd=document.createElement("td");
          dTd.textContent = formatDate(cells[3]);
          tr.appendChild(dTd);

          // E –£—Å–ª–æ–≤–∏—è
          const condTd=document.createElement("td");
          condTd.innerHTML = linkify(cells[4]||"");
          tr.appendChild(condTd);

          tbody.appendChild(tr);
        });

        if(!tbody.children.length){
          const tr=document.createElement("tr");
          const td=document.createElement("td"); td.colSpan=5; td.textContent="–ù–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä—Å–æ–≤.";
          tr.appendChild(td); tbody.appendChild(tr);
        }

        // –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Å—Ç—Ä–µ–ª–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è
        const ts = document.getElementById("ts");
        const hint = document.getElementById("hintRight");
        const updateHint = () => {
          const need = ts.scrollWidth > ts.clientWidth && ts.scrollLeft < (ts.scrollWidth - ts.clientWidth - 8);
          hint.style.display = need ? "flex" : "none";
        };
        ts.addEventListener("scroll", updateHint);
        window.addEventListener("resize", updateHint);
        updateHint();
      })
      .catch(err=>{
        console.error(err);
        const tbody = document.querySelector("#tbl tbody");
        const tr=document.createElement("tr");
        const td=document.createElement("td"); td.colSpan=5; td.textContent="–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
        tr.appendChild(td); tbody.appendChild(tr);
      });
  </script>
</body>
</html>
